= Lab Guide: Creating a Workflow Job Template
:notoc:
:toc-title: Table of Contents
:sectnums:
:icons: font

_A guide to connecting all the dots by linking multiple playbooks with conditional logic in a workflow._

---

== Lab Briefing

A **workflow job template** links together different resources in a graphical way. This can include multiple job templates (playbooks), project syncs, and even other workflows, allowing you to build complex, multi-step automation processes.

image::../assets/images/wf-templates-home-with-example-wf-template.png[Workflow Job Templates list view, opts="border"]

---

== Lab Guide: Hands-On Tasks

A **Workflow Job Template** is a series of connected automation tasks that are executed in a specific order. While a standard Job Template handles a single playbook, a Workflow Job Template is designed for more complex scenarios involving multiple playbooks and decision-making processes.

Workflows can orchestrate various node types, including:

* Job templates
* Other workflow job templates
* Project syncs
* Inventory source syncs

[WARNING]
====
Remember not to confuse a **Job Template**, a **Jinja template**, and a **Workflow Job Template**. They are three separate concepts.
====

[IMPORTANT]
====
Reminder that the credentials to log in to the automation controller are:

* *Username:* `admin`
* *Password:* `ansible123!`
====

=== Task 1: Create a Workflow Template

First, you will create the main workflow that will contain your job templates.

. **Navigate to the Templates page.**
+
In the left navigation menu, go to **Automation Execution** â†’ **Templates**.

. **Create a new workflow job template.**
+
**Click** the blue **Create template** button and select **Create workflow job template**.

. **Enter the workflow details.**
+
Fill out the form with the following information:
+
* **Name:** `Your first workflow`
* **Description:** `Create a Workflow from previous Job Templates`
* **Organization:** `Default`
* **Inventory:** `Lab-Inventory`

. **Save the workflow.**
+
Leave all other fields as they are and **click** the blue **Create workflow job template** button.

=== Task 2: Add the First Step in the Workflow Visualizer

After saving, you will be taken to the Workflow Visualizer, where you can build your workflow graphically.

. **Add the first step.**
+
**Click** the **Start** button to add the first node.

. **Configure the first node.**
+
In the *Add step* side panel that appears, configure the node as follows:
+
* **Node Type:** `Job Template` (default)
* **Job Template:** `Install Apache`
* **Convergence:** `Any`
* **Node alias:** `apache101` (This is a simple label for the node in the visualizer)

. **Save the node.**
+
**Click** **Next**, review the details, and then **click** **Finish**.

=== Task 3: Add a Conditional Step

Next, you will add a second step that runs only if the first step is successful.

. **Add a new linked step.**
+
**Hover** over the `apache101` node, **click** the **+** icon, and select **Add node**.

. **Configure the second node.**
+
In the side panel, configure the new node as follows:
+
* **Node Type:** `Job Template` (default)
* **Job Template:** `Extended services`
* **Run:** `On Success`
* **Convergence:** `Any`
* **Node alias:** `extended201`

. **Save the node.**
+
**Click** **Next**, review the details, and then **click** **Finish**.

=== Task 4: Add a Parallel Step

Now, add a third step that also runs after the first step, in parallel with the second step.

. **Add another linked step from the first node.**
+
**Hover** over the `apache101` node again, **click** the **+** icon, and select **Add node**.

. **Configure the third node.**
+
* **Node Type:** `Job Template` (default)
* **Job Template:** `Set motd`
* **Run:** `On Success`
* **Convergence:** `Any`
* **Node alias:** `motd201`

. **Save the node.**
+
**Click** **Next**, review the details, and then **click** **Finish**.

. **Save the entire workflow.**
+
Finally, **click** the blue **Save** button in the top right corner of the Visualizer. If you miss this step, you will lose your changes!

=== Task 5: Launch the Workflow

Now you are ready to run your multi-step workflow.

. **Launch the workflow from the Visualizer.**
+
While still in the Workflow Visualizer, **click** the **Launch** button in the top right.

. **Observe the execution.**
+
You will be taken to a real-time view of the workflow execution. You will notice the `apache101` job runs first. Once it succeeds, both the `extended201` and `motd201` jobs will run in parallel. A green checkmark (âœ…) on each node indicates a successful run.

. **(Alternative) Launch from the Templates list.**
+
You can also launch the workflow by navigating back to the **Templates** page and clicking the **Launch** icon (ðŸš€) next to `Your first workflow`.

---

== Next Steps

Press the `Check` button below to proceed to the next challenge.

== Troubleshooting

If you have encountered an issue or have noticed something not quite right, please link:https://github.com/ansible/instruqt/issues/new?labels=controller-101&title=Issue+with+Intro+to+Controller+slug+ID:+controller-101-workflow+AAP25&assignees=leogallego[open an issue on GitHub].
